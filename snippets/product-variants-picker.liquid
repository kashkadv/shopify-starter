<form class="mt-10">
  <variant-selects
    id="variant-radios-{{ section.id }}"
    class="mt-10"
    data-section="{{ section.id }}"
    data-url="{{ product.url }}"
    {% if update_url == false %}
      data-update-url="false"
    {% endif %}
  >
    {% unless product.has_only_default_variant %}
      
      {%- for option in product.options_with_values -%}
        {%- liquid
          assign variants_available_arr = product.variants | map: 'available'
          assign variants_option1_arr = product.variants | map: 'option1'
          assign variants_option2_arr = product.variants | map: 'option2'
          assign variants_option3_arr = product.variants | map: 'option3'
        -%}

        <div class="mt-10">
          <h3 class="text-sm font-medium text-gray-900 mb-2">{{ option.name }}</h3>
          <fieldset class="grid grid-cols-3 gap-4 sm:grid-cols-8 lg:grid-cols-3">
            {% for value in option.values %}

              {%- liquid
                assign option_disabled = true
                for option1_name in variants_option1_arr
                  case option.position
                    when 1
                      if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                    when 2
                      if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                    when 3
                      if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                  endcase
                endfor
              -%}
              
              <label class="group relative flex items-center justify-center rounded-md border py-3 px-4 text-sm font-medium hover:bg-gray-50 focus:outline-none sm:flex-1 sm:py-6 cursor-pointer bg-white text-gray-900 shadow-sm">
                <input {% if option_disabled == true %}disabled{% endif %} type="radio" name="{{ option.name }}" value="{{ value |  escape }}" class="sr-only peer" {% if value == option.selected_value %}checked{% endif %} aria-labelledby="size-choice-1-label">
                <span class="peer-disabled:line-through peer-disabled:opacity-50" id="{{ option.name }}-{{ forloop.index }}">{{ value }}</span>
                <span class="pointer-events-none absolute -inset-px rounded-md peer-disabled:bg-neutral-500/10 peer-disabled:border-none peer-checked:border-neutral-500/50 peer-checked:border" aria-hidden="true"></span>
              </label>
            {% endfor %}
          </fieldset>
        </div>          
      {%- endfor -%}
    {% endunless %}
  
    <script type="application/json">
    {{ product.variants | json }}
    </script>  
    
    <button type="submit" class="mt-10 flex w-full items-center justify-center rounded-md border border-transparent bg-indigo-600 px-8 py-3 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Add to bag</button>
  </variant-selects>
</form>